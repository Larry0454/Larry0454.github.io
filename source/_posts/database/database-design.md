---
title: 『database-5』database design
date: 2024-03-27 21:21:39
tags: database
---

## 数据库设计

---

### 一、数据库设计阶段概览

1. 需求分析：对<u>应用环境</u>进行详细调查，收集支持系统目标的**基础数据**及其处理

2. 数据库概念结构设计：

   - 对用户需求进行<u>综合</u>、<u>归纳</u>与<u>抽象</u>
   - 设计<u>独立于</u>数据库逻辑结构与DBMS的概念模型（可用 E-R 图表示）

3. 数据库逻辑结构设计：

   - 将概念结构转换为某个DBMS所支持的数据模型，并作优化
   - 将得到的逻辑结构转换成特定的DBMS能处理的**模式**、**子模式**

4. 数据库物理结构设计：设计物理设备的<u>存储结构</u>与<u>存取方法</u>

   1. 确定数据库的**内模式**
   2. 对物理结构进行时间与空间效率的**评价**

5. 数据库实施：用**DDL**描述三级模式，并调试产生**目标模式**，组织数据入库并**试运行**

6. 数据库运行与维护：数据库正式运行后，由DBA对数据库维护

   <figure style="text-align:center">
       <img src="数据库设计基本步骤.png">
       <figurecap>数据库设计阶段</figurecap>
   </figure>

---

### 二、需求分析

- 需求分析的目标：调查重点是“数据”与“处理”

  - 处理要求：用户需要完成何种**处理功能**
  - 信息要求：指系统中所涉及的**数据**及**数据间联系**
  - 安全性与完整性约束

- 需求分析的步骤：

  1. 调查用户实际需求，与用户达成共识
  2. 使用<u>数据流图</u>表达**数据处理间的关系**；使用<u>数据字典</u>描述系统中的**各类数据**

- 数据流图：以图形方式表达系统功能、数据在系统内部的逻辑流向

  <figure style="text-align:center">
      <img src="数据流图.png">
      <figurecap>自顶向下分解的 销售管理系统 数据流图</figurecap>
  </figure>

  ---

- 数据字典：对数据库中数据的描述（即**元数据**），其原子单位是数据项，包含以下

  - 数据项语义定义：名字 + 实际含义
  - 数据项类型定义：数据类型 + 数据宽度 + 小数位数
  - 完整性约束定义：值约束 + 空值约束 + 其它完整性约束

  **注意**：数据字典还包括数据在系统内的<u>传输路径</u>、<u>存储位置</u>等

---

### 三、概念结构设计

- E-R 法：使用 **E-R图** 描述现实世界

- E-R 图：由<u>实体</u>、<u>联系</u>、<u>属性</u>构成

- 自底向上的 E-R 图设计方法：先设计**局部**应用的概念结构，再将其**集成**起来

  - 局部 E-R 图设计：

    1. 选择局部应用：将需求分解形成不同的概念模式
    2. 以需求分析中的数据元素为基础，利用**数据抽象**机制，得到<u>实体</u>与<u>属性</u>
       <br>**注意**：“数据抽象”包括分类（对象的类型）、聚集（类型的组成）和概括（类型间的联系）
    3. 确定实体间的联系类型，用 E-R 图表示这些<u>实体与实体间的**联系**</u>，形成分 E -R 图

  - 综合局部 E-R 图：将分 E-R 图<u>合并</u>，<u>消除冲突与冗余</u>，最终形成基本 E-R 图

    - 生成初步 E-R 图：消除分 E-R 图的冲突，需消除属性冲突 + 命名冲突 + 结构冲突

      - 属性冲突：属性的<u>类型</u>、<u>取值范围</u>或<u>取值集合</u>不同
      - 命名冲突：不同意义的对象具有相同名字 or 相同意义的对象具有不同名字
      - 结构冲突：同一对象在<u>不同应用</u>中具有**不同层次的抽象**；同一实体拥有**不同的属性**

    - 生成基本 E-R 图：对初步 E-R 图**消除冗余**；方法包括分析法 + 规范化

      - 冗余数据：可由基本数据**导出**的数据；系总人数 = $\sum \text{各系人数}$，系总人数为冗余数据
      
      - 冗余联系：可由其它联系**导出**的联系
      
        ---
      
      - **规范化**消除冗余联系：筛除分E-R图中的冗余关系
      
        1. 确定分E-R图中的数据依赖：将<u>每对联系</u>表示为<u>实体码间</u>的**函数依赖**集合F
        2. 对上述依赖集进行**极小化处理**获得 $\text{F}_m$，设 D = F - $\text{F}_m$
        3. 考察 D 中的每个依赖式，筛除其中的冗余联系
      
        **注意**：冗余信息或许能够提高数据库效率，可以选择保留
      

---

### 三、逻辑结构设计

- E-R 图向关系模式的转化：
  - 实体型 $\Rightarrow$ 关系模式：关系的属性 $\gets$ 实体的属性；关系的码 $\gets$ 实体的码
  - 联系 $\Rightarrow$ 关系模式：关系的属性 $\gets$ 各实体的**码** + **联系的属性**
    - 1: 1联系：<u>每个实体的码</u>都是该关系的候选码
    - 1: n联系：该关系的码是<u>**n端**实体的码</u>（唯一确定性）
    - n: m联系：该关系的码是<u>**两端**实体码的**组合**</u>（唯一确定性）
- 关系模型的优化：考虑 <u>水平分解</u> + <u>垂直分解</u>
  - 水平分解：将**经常使用的那部分<u>元组</u>**分离出来单独作为一个关系
  - 垂直分解：将关系模式R中**经常在一起使用的<u>属性</u>**分解出来形成子模式

---

### 四、物理结构设计

- 数据库物理结构：包含物理设备上的 <u>存储结构</u> + <u>存取方法</u>

- 存取方法：包括 索引 + 聚集 + HASH

  - 索引记录：索引文件中的记录，包括 索引域 + 指针；常用 B+ 树

    - 索引域：存储数据文件中若干域的**特定值K**
      <br>**注意**：索引域应选择<u>经常被查询</u>到的属性、max（min）函数的<u>参数</u>、<u>连接属性</u>等
    - 指针：指向**索引域值K**的记录所<u>在磁盘块的地址</u>

    **注意**：索引也会占据内存，同时具有维护开销，故索引不是越多越好

    <figure style="text-align:center">
        <img src="B+树.png">
        <figurecap>各关键字按递增顺序 从左到右 链接在叶结点上</figurecap>
    </figure>

  - 聚集：将在若干属性上<u>值相同</u>的记录集中存放在**连续的物理块**上

    - 选择原则：经常进行<u>自然连接</u>操作的关系、某属性<u>值重复率高</u>的模式

    **注意**：建立聚集系统的开销很大，对于更新操作**远多于连接操作**的关系，不应建立聚集

  - HASH：利用hash函数将**记录关键字**转化为地址；记录r（A上值为a）的存储地址 addr = hash(a)

    <figure style="text-align:center">
        <img src="HASH.png">
        <figurecap>Hash查找</figurecap>
    </figure>
